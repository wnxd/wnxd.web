(function () { function Ready(fn) { if (document.addEventListener) { document.addEventListener("DOMContentLoaded", function () { document.removeEventListener("DOMContentLoaded", arguments.callee, false); fn() }, false) } else if (document.attachEvent) { document.attachEvent("onreadystatechange", function () { if (document.readyState === "complete") { document.detachEvent("onreadystatechange", arguments.callee); fn() } }) } } function BindEvent(dom, type, f) { if (dom.addEventListener) { if (type.substring(0, 2) == "on") type = type.substring(2); dom.addEventListener(type, f, false) } else if (dom.attachEvent) { if (type.substring(0, 2) != "on") type = "on" + type; dom.attachEvent(type, f) } } function GetForm(dom) { var form = dom.parentNode, tagname = form.tagName.toLowerCase(); while (tagname != "form" && tagname != "body") { form = form.parentNode; tagname = form.tagName.toLowerCase() } return form } function Ajax(type, url) { var XMLHttpReq, argv = arguments; try { XMLHttpReq = new ActiveXObject("Msxml2.XMLHTTP") } catch (e) { try { XMLHttpReq = new ActiveXObject("Microsoft.XMLHTTP") } catch (e) { XMLHttpReq = new XMLHttpRequest() } } type = type.toLowerCase(); XMLHttpReq.open(type, url, true); XMLHttpReq.onreadystatechange = function (e) { if (XMLHttpReq.readyState == 4) { var callback; if (type == "post") callback = argv[3]; else callback = argv[2]; if (typeof (callback) == "function") callback(XMLHttpReq.responseText, e) } }; var data = null; if (type == "post") { XMLHttpReq.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); data = argv[2] } XMLHttpReq.send(data) } function GetDOM(dom) { return _GetDOM(dom) } function _GetDOM(dom) { var list = dom.children, form = []; for (var i = 0; i < list.length; i++) { var d = list[i], tag = d.tagName.toLowerCase(); if (tag == "input" || tag == "textarea" || tag == "select") form.push(d); else if (d.children.length > 0) form = form.concat(_GetDOM(d)) } return form } function Finish(dom) { var form = GetDOM(dom), data = "", list = {}; for (var i = 0; i < form.length; i++) { var d = form[i]; if (d.name != "") { var tag = d.tagName.toLowerCase(); if (tag == "input") { if (d.type == "checkbox") { if (d.checked) { var v = list[d.name]; if (typeof (v) == "undefined") list[d.name] = d.value; else list[d.name] = v + "," + d.value } } else if (d.type == "radio") { if (d.checked) list[d.name] = d.value } else list[d.name] = d.value } else list[d.name] = d.value } } for (var key in list) data += "&" + key + "=" + encodeURIComponent(list[key]); return data == "" ? "" : data.substring(1) } Ready(function () { for (var i = 0; i < document.all.length; i++) { var dom = document.all[i], prefix = dom.getAttribute("prefix"); if (prefix != null && prefix != "") { var onclick = dom.getAttribute("onclick"); if (typeof (onclick) == "string" && onclick != "") { (function (dom, prefix, onclick) { var click = false, url = dom.getAttribute("url"); if (url == null) url = "$url$"; dom.style.cursor = "pointer"; dom.removeAttribute("onclick"); BindEvent(dom, "click", function () { if (click) { var repeat = dom.getAttribute("repeat"); if (repeat != null) new Function(repeat + "();")(); return false } var verify = dom.getAttribute("verify"); if (verify != null && new Function("return " + verify + "();")() != true) return false; click = true; var act = dom.getAttribute("act"), inc = dom.getAttribute("inc"), callback = dom.getAttribute("callback"); if (act == null) act = inc == null ? "form" : "post"; if (act != "form") { callback = callback == null ? function (e) { if (e != "") alert(e) } : new Function(callback + "(arguments[0],arguments[1]);") } switch (act) { case "form": var form; if (inc == null) { form = GetForm(dom); if (form == null) { var element = GetDOM(document.body); form = document.createElement("form"); form.style.display = "none"; document.body.appendChild(form); form.method = "post"; form.action = url; for (var i = 0; i < element.length; i++) form.appendChild(element[i]); form.appendChild(input) } } else { inc = document.getElementById(inc); if (inc == null) inc = document.body; var element = GetDOM(inc); form = document.createElement("form"); form.style.display = "none"; document.body.appendChild(form); form.method = "post"; form.action = url; for (var i = 0; i < element.length; i++) form.appendChild(element[i]) } var input = document.createElement("input"); input.setAttribute("type", "hidden"); input.setAttribute("name", prefix); input.setAttribute("value", onclick); form.appendChild(input); form.submit(); return false; case "post": inc = inc != null ? document.getElementById(inc) : document.body; if (inc == null) inc = document.body; Ajax("post", url, prefix + "=" + onclick + "&" + Finish(inc), function (ret, e) { click = false; callback(ret, e) }); return false; case "get": inc = inc != null ? document.getElementById(inc) : document.body; if (inc == null) inc = document.body; Ajax("get", url + (url.indexOf("?") == -1 ? "?" : "&") + prefix + "=" + onclick + "&" + Finish(inc), function (ret, e) { click = false; callback(ret, e) }); return false } }) })(dom, prefix, onclick) } } } }) })();